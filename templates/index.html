<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>For My Cutu üíï</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&family=Caveat:wght@600;700&display=swap" rel="stylesheet">
    <style>
        body { 
            font-family: 'Poppins', sans-serif; 
            margin: 0;
            padding: 0;
            overflow-x: hidden;
        }
        
        /* Aesthetic Animated Background */
        .romantic-bg {
            background: linear-gradient(-45deg, #fce7f3, #fbcfe8, #ffedd5, #ffe4e6);
            background-size: 400% 400%;
            animation: gradientBG 15s ease infinite;
            min-height: 100vh;
        }

        @keyframes gradientBG {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        /* Glassmorphism Cards */
        .glass-card {
            background: rgba(255, 255, 255, 0.7);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border-radius: 24px;
            border: 1px solid rgba(255, 255, 255, 0.8);
            box-shadow: 0 8px 32px 0 rgba(255, 182, 193, 0.3);
        }

        .font-handwriting { font-family: 'Caveat', cursive; }
        
        .app-container { max-width: 600px; min-height: 100vh; margin: 0 auto; position: relative; padding: 1rem; }
        
        /* Game Styles */
        .flip-container { perspective: 1000px; cursor: pointer; }
        .flipper { transition: 0.6s; transform-style: preserve-3d; position: relative; }
        .flip-container.flipped .flipper { transform: rotateY(180deg); }
        .front, .back { backface-visibility: hidden; position: absolute; top: 0; left: 0; width: 100%; height: 100%; border-radius: 1rem; display: flex; align-items: center; justify-content: center; }
        .front { z-index: 2; transform: rotateY(0deg); background: linear-gradient(135deg, #fbcfe8 0%, #f9a8d4 100%); border: 2px solid white; box-shadow: 0 4px 15px rgba(249, 168, 212, 0.4);}
        .back { transform: rotateY(180deg); }
        
        /* Coupon Styles */
        .coupon-card { 
            background: rgba(255, 255, 255, 0.9);
            border: 2px dashed #f472b6; 
            position: relative; 
            transition: all 0.3s ease; 
            border-radius: 16px;
        }
        .stamp { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%) rotate(-15deg); color: #db2777; border: 4px solid #db2777; font-size: 2rem; font-weight: 900; padding: 10px 20px; text-transform: uppercase; opacity: 0; pointer-events: none; transition: opacity 0.3s ease; z-index: 10; background: rgba(255,255,255,0.9); border-radius: 12px;}
        .is-redeemed .stamp { opacity: 1; }
        .is-redeemed { filter: grayscale(0.3); opacity: 0.8; }
        
        /* Buttons */
        .btn-primary {
            background: linear-gradient(135deg, #f43f5e 0%, #ec4899 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(236, 72, 153, 0.3);
            transition: all 0.2s ease;
        }
        .btn-primary:hover { transform: translateY(-2px); box-shadow: 0 6px 20px rgba(236, 72, 153, 0.4); }
        .btn-primary:active { transform: translateY(1px); }

        .btn-secondary {
            background: white;
            color: #ec4899;
            border: 2px solid #fbcfe8;
            transition: all 0.2s ease;
        }
        .btn-secondary:hover { background: #fdf2f8; transform: translateY(-2px); }

        #login-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 50; display: flex; align-items: center; justify-content: center; flex-direction: column; }
        .hidden { display: none !important; }
    </style>
</head>
<body class="romantic-bg flex items-center justify-center">

    <div id="login-overlay" class="romantic-bg">
        <div class="glass-card p-10 text-center max-w-sm w-full mx-4">
            <div class="text-6xl mb-4 animate-bounce">üíå</div>
            <h1 class="text-3xl font-handwriting text-pink-600 mb-6">Welcome, Cutu</h1>
            
            <input type="text" id="username-input" placeholder="Username" 
                class="w-full p-3 bg-white/50 border border-pink-200 rounded-xl mb-3 focus:outline-none focus:ring-2 focus:ring-pink-400 focus:bg-white transition-all placeholder-gray-400">
            
            <input type="password" id="passcode-input" placeholder="Password" 
                class="w-full p-3 bg-white/50 border border-pink-200 rounded-xl mb-6 focus:outline-none focus:ring-2 focus:ring-pink-400 focus:bg-white transition-all placeholder-gray-400">
            
            <button id="login-btn" class="btn-primary w-full py-3 font-bold rounded-xl text-lg">
                Let's Go üíï
            </button>
            <p id="login-error" class="text-rose-500 text-sm mt-3 hidden font-medium">Wait... who are you? Wrong info!</p>
            <p id="loading-msg" class="text-gray-500 text-sm mt-3 hidden font-medium animate-pulse">Checking heartbeats...</p>
        </div>
    </div>

    <div id="app-root" class="app-container w-full hidden"></div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getDatabase, ref, set, onValue } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyAgfC16j7ocB2vR7DDfptq1Jo_XMcSTVkE",
            authDomain: "sam-webapp-32518.firebaseapp.com",
            projectId: "sam-webapp-32518",
            storageBucket: "sam-webapp-32518.firebasestorage.app",
            messagingSenderId: "325387054592",
            appId: "1:325387054592:web:edae157d3a3630618cf2e5",
            measurementId: "G-M20ZVM21TE"
        };

        let app, db;
        try {
            app = initializeApp(firebaseConfig);
            db = getDatabase(app);
            console.log("Firebase connected successfully!");
        } catch (e) {
            console.error("Firebase failed to connect:", e);
        }

        // --- DATA ---
        const MEMORY_PAIRS = [
            { id: 1, content: 'Rushikonda First Kiss', icon: "{{ url_for('static', filename='photo1.png') }}" },
            { id: 2, content: 'Lily Photos', icon: "{{ url_for('static', filename='photo2.png') }}" },
            { id: 3, content: 'Mickey17 Night', icon: "{{ url_for('static', filename='photo3.png') }}" },
            { id: 4, content: 'May Maggie Morning', icon: "{{ url_for('static', filename='photo4.png') }}" },
            { id: 5, content: 'Wipro Kakinada Week', icon: "{{ url_for('static', filename='photo5.png') }}" },
            { id: 6, content: 'Memory Six', icon: "{{ url_for('static', filename='photo6.png') }}" },
            { id: 7, content: 'Memory Seven', icon: "{{ url_for('static', filename='photo7.png') }}" },
            { id: 8, content: 'Memory Eight', icon: "{{ url_for('static', filename='photo8.png') }}" },
        ];
        
        const QUIZ_QUESTIONS = [
            { id: 1, question: "Where did we first kiss?", options: ["Area 51 cafe", "Rushikonda beach", "RK beach", "Teneti Park"], correctAnswer: "Rushikonda beach" }, 
            { id: 2, question: "What flower photos did I send you when we started texting?", options: ["Lotus", "Rose", "Lily", "Lavender"], correctAnswer: "Lily" }, 
            { id: 3, question: "What was the first movie we watched together?", options: ["Dragon", "Mickey17", "Dhadak 2", "Mad Square"], correctAnswer: "Mickey17" }, 
            { id: 4, question: "In which month we ate our first Rushikonda morning maggie?", options: ["May", "April", "June", "March"], correctAnswer: "May" }, 
            { id: 5, question: "Which company's exam was I writing when I stayed for a week in Kakinada?", options: ["Infosys", "Capgemini", "IBM", "Wipro"], correctAnswer: "Wipro" }, 
        ];

        const COUPON_QUESTIONS = [
            { id: 1, question: "Who is the cutest person in the world?", options: ["Sampreethi", "Raghu", "Both"], correct: "Sampreethi", rewardTitle: "The Human Taxi Service", rewardDesc: "One free piggyback ride whenever you feel like it. No distance limit (pls be kind)." },
            { id: 2, question: "What is raghu's favorite thing to do?", options: ["Eating", "Sleeping", "Annoying Sam"], correct: "Annoying Sam", rewardTitle: "The 'SEX' Card", rewardDesc: "One time validity. Your wish is my command cutu. üòâ" },
            { id: 3, question: "If Sampreethi angry, what should raghu do?", options: ["Make fun of her", "Feed her food", "Ignore her"], correct: "Feed her food", rewardTitle: "The Flower Finder", rewardDesc: "I will find and bring you flowers. Anytime. Anywhere." },
            { id: 4, question: "Where do Raghu belong?", options: ["In Sampreethi's arms", "In hell", "In class"], correct: "In Sampreethi's arms", rewardTitle: "The Smooth Touch", rewardDesc: "One uninterrupted full body massage to melt your stress away." },
            { id: 5, question: "Do you love me?", options: ["Yes", "Maybe", "No"], correct: "Yes", rewardTitle: "What you see, I see", rewardDesc: "We watch exactly what YOU want. Even if it's terrible, I won't complain." }
        ];
        
        const FINAL_GIFT = { title: "You did it, Cutu!", message: "I love youuuuu üí©", photoUrl: "{{ url_for('static', filename='final_photo.jpg') }}" };

        let localState = {
            quizPassed: false,
            coupons: COUPON_QUESTIONS.map(q => ({ status: 'unanswered' })),
            oweData: { raghu: { count: 0, logs: [], showLogs: false }, sampreethi: { count: 0, logs: [], showLogs: false } }
        };
        let currentUser = null;
        let currentDbPath = '';

        document.getElementById('login-btn').addEventListener('click', handleLogin);

        function handleLogin() {
            const user = document.getElementById('username-input').value.toLowerCase().trim();
            const pass = document.getElementById('passcode-input').value.trim();
            const errorMsg = document.getElementById('login-error');
            const loadingMsg = document.getElementById('loading-msg');

            let isAdmin = (user === 'admin' && pass === 'admin');
            let isUser = (user === 'sampreethi' && pass === 'samghu3');

            if (!isAdmin && !isUser) {
                errorMsg.classList.remove('hidden');
                return;
            }

            if (isAdmin) {
                currentUser = 'Admin (Test)';
                currentDbPath = 'admin_test_zone'; 
            } else {
                currentUser = 'Sampreethi üíñ';
                currentDbPath = 'real_gift_data'; 
            }

            errorMsg.classList.add('hidden');
            loadingMsg.classList.remove('hidden');

            const dataRef = ref(db, currentDbPath); 
            onValue(dataRef, (snapshot) => {
                loadingMsg.classList.add('hidden');
                document.getElementById('login-overlay').classList.add('hidden');
                document.getElementById('app-root').classList.remove('hidden');
                
                const data = snapshot.val();
                if (data) {
                    localState = data;
                    if(!localState.oweData) localState.oweData = { raghu: { count: 0, logs: [] }, sampreethi: { count: 0, logs: [] } };
                    if(!localState.coupons) localState.coupons = COUPON_QUESTIONS.map(q => ({ status: 'unanswered' }));
                } else {
                    set(dataRef, localState);
                }
                
                if(currentView === 'start') renderStartScreen();
                else if(currentView === 'coupons') renderCoupons();
                else if(currentView === 'owe') renderOweTracker();
            });
        }

        function syncToCloud() {
            set(ref(db, currentDbPath), localState);
        }

        const appRoot = document.getElementById('app-root');
        let currentView = 'start';
        let currentQuestionIndex = 0;
        let answers = {};
        
        window.renderStartScreen = renderStartScreen;
        window.renderQuiz = renderQuiz;
        window.renderCoupons = renderCoupons;
        window.renderOweTracker = renderOweTracker;
        window.checkCouponAnswer = checkCouponAnswer;
        window.redeemCoupon = redeemCoupon;
        window.updateOwe = updateOwe;
        window.toggleLogs = toggleLogs;
        window.logout = () => location.reload();
        window.initializeGame = initializeGame;
        window.handleTileClick = handleTileClick;
        window.renderMatchingGame = renderMatchingGame;
        
        // Propose Day Functions
        window.renderProposal = renderProposal;
        window.moveNoButton = moveNoButton;
        window.renderMarriageQuestion = renderMarriageQuestion;
        window.renderMarriageResult = renderMarriageResult;

        function renderStartScreen() {
            currentView = 'start';
            appRoot.innerHTML = `
                <div class="glass-card p-8 text-center relative overflow-hidden mt-6">
                    <div class="text-7xl mb-4 animate-bounce drop-shadow-lg">‚ú®</div>
                    <h1 class="text-5xl font-handwriting text-pink-600 mb-2 font-bold">Our Love Journey</h1>
                    <p class="text-pink-400 font-medium mb-8 text-sm tracking-wide">Hey, <span class="font-bold text-pink-500">${currentUser}</span></p>
                    
                    <div class="space-y-4">
                        <button onclick="renderProposal()" class="w-full py-4 px-6 bg-gradient-to-r from-red-400 to-rose-500 text-white font-bold text-lg rounded-2xl shadow-xl hover:shadow-rose-300/50 hover:-translate-y-1 transition-all">üíç Propose Day Special</button>
                        <button onclick="renderQuiz()" class="w-full py-4 px-6 bg-white text-pink-600 border-2 border-pink-200 font-bold text-lg rounded-2xl shadow-md hover:bg-pink-50 transition-all">üß© Play Our Quiz</button>
                        <button onclick="renderCoupons()" class="w-full py-4 px-6 bg-white text-pink-600 border-2 border-pink-200 font-bold text-lg rounded-2xl shadow-md hover:bg-pink-50 transition-all">üíå Unwrap Coupons</button>
                        <button onclick="renderOweTracker()" class="w-full py-4 px-6 bg-white text-pink-600 border-2 border-pink-200 font-bold text-lg rounded-2xl shadow-md hover:bg-pink-50 transition-all">‚öñÔ∏è "Who Owes Who" Tracker</button>
                        <button onclick="logout()" class="block w-full text-center text-xs text-gray-400 font-medium mt-6 hover:text-pink-500 transition">Lock App</button>
                    </div>
                </div>
            `;
        }

        // --- PROPOSE DAY LOGIC ---
        function renderProposal() {
            currentView = 'proposal';
            appRoot.innerHTML = `
                <div class="glass-card p-8 text-center relative mt-6 h-[400px] flex flex-col justify-center items-center" id="proposal-container">
                    <button onclick="renderStartScreen()" class="absolute top-4 left-6 text-pink-500 font-bold text-sm hover:text-pink-700 transition">‚Üê Back</button>
                    <h2 class="text-5xl font-handwriting text-rose-500 mb-10 leading-tight">Will you be my<br>Valentine? ü•∫</h2>
                    
                    <div class="relative w-full h-24 flex justify-center items-center">
                        <button onclick="renderMarriageQuestion()" class="btn-primary px-10 py-3 text-xl font-bold rounded-full absolute" style="left: 20%; z-index: 10;">Yes! üíñ</button>
                        <button id="no-btn" onmouseenter="moveNoButton()" ontouchstart="moveNoButton()" onclick="moveNoButton()" class="btn-secondary px-10 py-3 text-xl font-bold rounded-full absolute" style="right: 20%; z-index: 20;">No üíî</button>
                    </div>
                </div>
            `;
        }

        function moveNoButton() {
            const btn = document.getElementById('no-btn');
            const container = document.getElementById('proposal-container');
            
            // Calculate safe boundaries so it doesn't leave the card
            const maxX = container.clientWidth - btn.clientWidth - 40; // 40px padding safety
            const maxY = container.clientHeight - btn.clientHeight - 40;
            
            const randomX = Math.max(20, Math.floor(Math.random() * maxX));
            const randomY = Math.max(80, Math.floor(Math.random() * maxY)); // 80 avoids covering the text at the top
            
            btn.style.transition = "all 0.2s ease";
            btn.style.left = randomX + 'px';
            btn.style.top = randomY + 'px';
            btn.style.right = 'auto'; // clear right position
        }

        function renderMarriageQuestion() {
            appRoot.innerHTML = `
                <div class="glass-card p-8 text-center mt-6 flex flex-col justify-center items-center min-h-[400px] animate-fade-in">
                    <div class="text-6xl mb-4">üíç</div>
                    <h2 class="text-4xl font-handwriting text-rose-500 mb-8 leading-tight">Okay, one more question...<br>Will you marry me?</h2>
                    <div class="flex gap-4 w-full justify-center">
                        <button onclick="renderMarriageResult('yes')" class="btn-primary w-32 py-3 text-lg font-bold rounded-full">Yes</button>
                        <button onclick="renderMarriageResult('no')" class="btn-secondary w-32 py-3 text-lg font-bold rounded-full">No</button>
                    </div>
                </div>
            `;
        }

        function renderMarriageResult(answer) {
            let content = "";
            if (answer === 'yes') {
                content = `
                    <div class="text-6xl mb-4">ü§£</div>
                    <h2 class="text-3xl font-bold text-gray-800 mb-4">Are you dumb?</h2>
                    <p class="text-xl text-rose-600 font-medium mb-6">Don't be stupid! üòÇ</p>
                    <p class="text-sm text-gray-500 italic">(Just kidding, I love youuuuu üí©)</p>
                `;
            } else {
                content = `
                    <div class="text-6xl mb-4">üß†</div>
                    <h2 class="text-3xl font-bold text-gray-800 mb-4">Phew! Good decision.</h2>
                    <p class="text-xl text-emerald-500 font-medium mb-6">Very smart of you. ‚ú®</p>
                    <p class="text-sm text-gray-500 italic">(But you're still stuck with me anyway ‚ù§Ô∏è)</p>
                `;
            }

            appRoot.innerHTML = `
                <div class="glass-card p-8 text-center mt-6 flex flex-col justify-center items-center min-h-[400px]">
                    ${content}
                    <button onclick="renderStartScreen()" class="mt-10 px-6 py-2 bg-pink-50 text-pink-600 border border-pink-200 rounded-full font-bold hover:bg-pink-100 transition">Back to Home</button>
                </div>
            `;
        }

        // --- QUIZ ---
        function renderQuiz() {
            currentView = 'quiz';
            const q = QUIZ_QUESTIONS[currentQuestionIndex];
            if (!q) { renderQuizResult(); return; }
            
            appRoot.innerHTML = `
                <div class="glass-card p-8 mt-6 relative">
                    <button onclick="renderStartScreen()" class="text-pink-500 font-bold text-sm mb-6 hover:text-pink-700 transition">‚Üê Home</button>
                    <div class="text-xs text-pink-400 font-bold uppercase tracking-widest mb-2">Question ${currentQuestionIndex + 1} of ${QUIZ_QUESTIONS.length}</div>
                    <h2 class="text-2xl font-bold text-gray-800 mb-8 leading-snug">${q.question}</h2>
                    <div id="opts" class="space-y-3"></div>
                </div>`;
            
            q.options.forEach(opt => {
                const btn = document.createElement('button');
                btn.textContent = opt;
                btn.className = "w-full text-left py-4 px-6 bg-white/60 text-gray-800 rounded-xl hover:bg-pink-50 border border-pink-100 font-medium shadow-sm transition-all";
                btn.onclick = () => { answers[q.id] = opt; currentQuestionIndex++; renderQuiz(); };
                document.getElementById('opts').appendChild(btn);
            });
        }

        function renderQuizResult() {
            const score = QUIZ_QUESTIONS.filter(q => answers[q.id] === q.correctAnswer).length;
            const passed = score === QUIZ_QUESTIONS.length;
            if(passed) { localState.quizPassed = true; syncToCloud(); }

            appRoot.innerHTML = `
                <div class="glass-card p-10 text-center mt-6">
                    <div class="text-6xl mb-4">${passed ? 'üéâ' : 'ü•∫'}</div>
                    <h2 class="text-3xl font-bold text-gray-800 mb-2">Quiz Complete!</h2>
                    <p class="text-5xl font-black mb-8 ${passed?'text-pink-500':'text-gray-400'}">${score} <span class="text-2xl text-gray-400">/ ${QUIZ_QUESTIONS.length}</span></p>
                    ${passed ? `<button onclick="initializeGame(); renderMatchingGame()" class="btn-primary w-full py-4 text-lg font-bold rounded-xl shadow-lg">Level 2: Unlock Memories üîì</button>` : `<button onclick="location.reload()" class="btn-secondary w-full py-4 text-lg font-bold rounded-xl">Try Again üíî</button>`}
                </div>`;
        }

        // --- MEMORY GAME ---
        let gameTiles = [], flippedTiles = [], matchedPairs = 0, lockBoard = false;
        function initializeGame() {
            const d = MEMORY_PAIRS.flatMap(p => [{...p, uuid: p.id+'a'}, {...p, uuid: p.id+'b'}]);
            gameTiles = d.sort(() => 0.5 - Math.random()).map(t => ({...t, isFlipped:false, isMatched:false}));
            flippedTiles = []; matchedPairs = 0;
        }
        
        function renderMatchingGame() {
            appRoot.innerHTML = `
            <div class="glass-card p-6 mt-6">
                <div class="text-center mb-6">
                    <h2 class="text-2xl font-bold text-pink-600">Match Our Memories</h2>
                    <p class="text-sm text-gray-500 mt-1">Find the matching pairs</p>
                </div>
                <div class="grid grid-cols-4 gap-3" id="board"></div>
            </div>`;
            
            gameTiles.forEach((t, i) => {
                const el = document.createElement('div');
                el.className = `flip-container aspect-square ${t.isFlipped?'flipped':''} ${t.isMatched?'invisible':''}`;
                el.innerHTML = `<div class="flipper w-full h-full"><div class="front text-3xl">üíñ</div><div class="back bg-white border-2 border-pink-300 rounded-2xl overflow-hidden shadow-md"><img src="${t.icon}" class="w-full h-full object-cover"></div></div>`;
                el.onclick = () => handleTileClick(i);
                document.getElementById('board').appendChild(el);
            });
        }
        
        function handleTileClick(i) {
            if(lockBoard || gameTiles[i].isFlipped) return;
            gameTiles[i].isFlipped = true; flippedTiles.push(i); renderMatchingGame();
            if(flippedTiles.length === 2) {
                lockBoard = true;
                const [a,b] = flippedTiles;
                if(gameTiles[a].id === gameTiles[b].id) {
                    setTimeout(() => { gameTiles[a].isMatched=gameTiles[b].isMatched=true; matchedPairs++; flippedTiles=[]; lockBoard=false; renderMatchingGame(); if(matchedPairs===MEMORY_PAIRS.length) renderFinal(); }, 600);
                } else {
                    setTimeout(() => { gameTiles[a].isFlipped=gameTiles[b].isFlipped=false; flippedTiles=[]; lockBoard=false; renderMatchingGame(); }, 800);
                }
            }
        }
        
        function renderFinal() {
            appRoot.innerHTML = `
            <div class="glass-card p-8 text-center mt-6">
                <h1 class="text-4xl font-handwriting text-pink-600 mb-6">${FINAL_GIFT.title}</h1>
                <div class="p-2 bg-white rounded-xl shadow-sm mb-6 border border-pink-100">
                    <img src="${FINAL_GIFT.photoUrl}" class="w-full rounded-lg object-cover">
                </div>
                <p class="text-lg text-gray-700 font-medium mb-8">${FINAL_GIFT.message}</p>
                <button onclick="renderStartScreen()" class="btn-secondary px-8 py-3 rounded-full font-bold">Back to Home</button>
            </div>`;
        }

        // --- COUPONS ---
        function renderCoupons() {
            currentView = 'coupons';
            appRoot.innerHTML = `
            <div class="p-2 mt-4 min-h-screen">
                <div class="flex items-center mb-6 px-2">
                    <button onclick="renderStartScreen()" class="text-pink-600 font-bold mr-4 text-xl hover:scale-110 transition">‚Üê</button>
                    <h2 class="text-3xl font-handwriting font-bold text-gray-800">Your Special Gifts üíå</h2>
                </div>
                <div id="list" class="space-y-6 pb-10"></div>
            </div>`;
            
            COUPON_QUESTIONS.forEach((q, idx) => {
                const s = localState.coupons[idx];
                const div = document.createElement('div');
                if(s.status === 'unanswered') {
                    div.innerHTML = `
                    <div class="glass-card p-6 border-l-4 border-l-pink-400">
                        <h3 class="font-bold text-pink-600 mb-2 uppercase tracking-wide text-xs">Unlock Gift #${idx+1}</h3>
                        <p class="mb-4 text-gray-800 font-medium">${q.question}</p>
                        <div class="space-y-2 mb-5">
                            ${q.options.map(o => `
                            <label class="flex items-center space-x-3 p-3 bg-white/50 rounded-lg cursor-pointer hover:bg-white transition border border-transparent hover:border-pink-100">
                                <input type="radio" name="q${idx}" value="${o}" class="text-pink-500 focus:ring-pink-500">
                                <span class="text-sm text-gray-700 font-medium">${o}</span>
                            </label>`).join('')}
                        </div>
                        <button onclick="checkCouponAnswer(${idx})" class="w-full py-3 bg-gray-800 text-white rounded-xl font-bold hover:bg-gray-900 transition shadow-md">Unlock Gift üîì</button>
                    </div>`;
                } else {
                    const r = s.status === 'redeemed';
                    div.innerHTML = `
                    <div class="coupon-card p-6 text-center ${r?'is-redeemed shadow-none':'shadow-lg bg-white/80'}">
                        <div class="stamp">Redeemed üíï</div>
                        <div class="text-4xl mb-3">üé´</div>
                        <h3 class="text-xl font-bold text-pink-600 mb-2">${q.rewardTitle}</h3>
                        <p class="text-sm text-gray-600 mb-6 px-4">${q.rewardDesc}</p>
                        <button onclick="redeemCoupon(${idx})" ${r?'disabled' : ''} class="w-full py-3 ${r?'bg-gray-200 text-gray-400':'btn-primary text-white'} font-bold rounded-xl shadow-sm uppercase tracking-wide text-sm">${r?'Used Up':'Claim Now'}</button>
                    </div>`;
                }
                document.getElementById('list').appendChild(div);
            });
        }

        function checkCouponAnswer(idx) {
            const sel = document.querySelector(`input[name="q${idx}"]:checked`);
            if(!sel) return alert("Pick an answer cutu!");
            if(sel.value === COUPON_QUESTIONS[idx].correct) {
                localState.coupons[idx].status = 'won';
                syncToCloud();
            } else alert("Nope! Try again üòõ");
        }

        function redeemCoupon(idx) {
            if(confirm("Are you sure you want to use this now?")) {
                localState.coupons[idx].status = 'redeemed';
                syncToCloud();
            }
        }

        // --- OWE TRACKER ---
        function renderOweTracker() {
            currentView = 'owe';
            appRoot.innerHTML = `
            <div class="p-2 mt-4 min-h-screen">
                <div class="flex items-center mb-8 px-2">
                    <button onclick="renderStartScreen()" class="text-pink-600 font-bold mr-4 text-xl hover:scale-110 transition">‚Üê</button>
                    <h2 class="text-3xl font-handwriting font-bold text-gray-800">The "Owe Me" Ledger ‚öñÔ∏è</h2>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 pb-10">
                    ${renderPC('raghu', 'Raghu')}
                    ${renderPC('sampreethi', 'Sampreethi')}
                </div>
            </div>`;
        }

        function renderPC(key, name) {
            const d = localState.oweData[key];
            if(!d.logs) d.logs = [];
            const logs = d.logs.slice(0, 10).map(l => `<li class="text-xs text-gray-600 flex justify-between border-b border-pink-50 py-2"><span>${l.msg}</span><span class="text-gray-400">${l.date}</span></li>`).join('');
            
            return `
            <div class="glass-card p-6 relative">
                <h3 class="text-xl font-bold text-gray-800 text-center mb-1">${name}</h3>
                <p class="text-center text-xs text-pink-500 uppercase tracking-wider font-semibold mb-6">Favors Owed</p>
                
                <div class="text-center mb-8">
                    <span class="text-7xl font-black ${d.count > 0 ? 'text-rose-500 drop-shadow-md' : 'text-gray-300'}">${d.count}</span>
                </div>
                
                <div class="flex justify-center gap-6 mb-6">
                    <button onclick="updateOwe('${key}', -1)" class="w-14 h-14 rounded-full bg-white border border-gray-200 text-gray-500 font-bold text-2xl shadow-sm hover:bg-gray-50 transition">-</button>
                    <button onclick="updateOwe('${key}', 1)" class="w-14 h-14 rounded-full bg-pink-500 text-white font-bold text-2xl shadow-md hover:bg-pink-600 hover:shadow-lg transition">+</button>
                </div>
                
                <div class="text-center">
                    <button onclick="toggleLogs('${key}')" class="text-xs text-gray-400 font-bold uppercase tracking-wider hover:text-pink-500 transition mb-3">${d.showLogs?'Hide History ‚Üë':'Show History ‚Üì'}</button>
                    ${d.showLogs?`<ul class="text-left bg-white/60 p-3 rounded-xl shadow-inner max-h-40 overflow-y-auto">${logs}</ul>`:''}
                </div>
            </div>`;
        }

        function updateOwe(person, change) {
            localState.oweData[person].count += change;
            localState.oweData[person].logs.unshift({ 
                date: new Date().toLocaleString('en-IN', {month:'short', day:'numeric', hour:'2-digit', minute:'2-digit'}), 
                msg: change>0 ? 'Added 1 owe üìà' : 'Removed 1 owe üìâ' 
            });
            syncToCloud();
        }

        function toggleLogs(person) {
            localState.oweData[person].showLogs = !localState.oweData[person].showLogs;
            renderOweTracker();
        }
    </script>
</body>
</html>
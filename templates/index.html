<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Our Christmas Love Quest</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Mountains+of+Christmas:wght@400;700&family=Inter:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        h1, h2, h3 { font-family: 'Inter', sans-serif; } /* Kept readable font for main text */
        
        /* Snowfall Animation Effect */
        @keyframes snow {
            0% { background-position: 0px 0px; }
            100% { background-position: 100px 1000px; }
        }
        .christmas-bg {
            background-color: #fef2f2;
            background-image: url('data:image/svg+xml,%3Csvg width="20" height="20" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"%3E%3Cg fill="%23d1fae5" fill-opacity="0.8" fill-rule="evenodd"%3E%3Ccircle cx="3" cy="3" r="1"/%3E%3Ccircle cx="13" cy="13" r="1"/%3E%3C/g%3E%3C/svg%3E');
        }

        .app-container { max-width: 600px; min-height: 100vh; margin: 0 auto; }
        
        /* Card & Flip Styles */
        .flip-container { perspective: 1000px; cursor: pointer; }
        .flipper { transition: 0.6s; transform-style: preserve-3d; position: relative; }
        .flip-container.flipped .flipper { transform: rotateY(180deg); }
        .front, .back { backface-visibility: hidden; position: absolute; top: 0; left: 0; width: 100%; height: 100%; border-radius: 0.75rem; display: flex; align-items: center; justify-content: center; }
        .front { z-index: 2; transform: rotateY(0deg); }
        .back { transform: rotateY(180deg); }
        .back img { image-rendering: -webkit-optimize-contrast; image-rendering: crisp-edges; }
        
        /* Christmas Coupon Styles */
        .coupon-card {
            border: 4px solid #dc2626; /* Red Border */
            background-color: #fff;
            background-image: radial-gradient(#f0fdf4 15%, transparent 16%), radial-gradient(#f0fdf4 15%, transparent 16%);
            background-size: 20px 20px;
            position: relative;
            transition: all 0.3s ease;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        }
        .stamp {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) rotate(-15deg);
            color: #15803d; /* Green Stamp */
            border: 4px solid #15803d;
            font-size: 2rem;
            font-weight: 900;
            padding: 10px 20px;
            text-transform: uppercase;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease, transform 0.3s ease;
            z-index: 10;
            background: rgba(255,255,255,0.9);
            border-radius: 8px;
        }
        .is-redeemed .stamp {
            opacity: 1;
            transform: translate(-50%, -50%) rotate(-15deg) scale(1);
        }
        .is-redeemed {
            filter: grayscale(0.5);
            opacity: 0.8;
        }

        .back-btn { cursor: pointer; transition: color 0.2s; display: inline-block; }
        
        /* Festive Button */
        .btn-festive {
            transition: transform 0.2s;
        }
        .btn-festive:active {
            transform: scale(0.95);
        }
    </style>
</head>
<body class="christmas-bg p-4 flex items-center justify-center">

    <div id="app-root" class="app-container w-full">
        </div>

    <script>
        // --- DATA ---

        // Level 1: Quiz (UNCHANGED WORDS)
        const QUIZ_QUESTIONS = [
            { id: 1, question: "Where did we first kiss?", options: ["Area 51 cafe", "Rushikonda beach", "RK beach", "Teneti Park"], correctAnswer: "Rushikonda beach" }, 
            { id: 2, question: "What flower photos did I send you when we started texting?", options: ["Lotus", "Rose", "Lily", "Lavender"], correctAnswer: "Lily" }, 
            { id: 3, question: "What was the first movie we watched together?", options: ["Dragon", "Mickey17", "Dhadak 2", "Mad Square"], correctAnswer: "Mickey17" }, 
            { id: 4, question: "In which month we ate our first Rushikonda morning maggie?", options: ["May", "April", "June", "March"], correctAnswer: "May" }, 
            { id: 5, question: "Which company's exam was I writing when I stayed for a week in Kakinada?", options: ["Infosys", "Capgemini", "IBM", "Wipro"], correctAnswer: "Wipro" }, 
        ];

        // Level 2: Memory Game (UNCHANGED WORDS)
        const MEMORY_PAIRS = [
            { id: 1, content: 'Rushikonda First Kiss', icon: "{{ url_for('static', filename='photo1.png') }}" },
            { id: 2, content: 'Lily Photos', icon: "{{ url_for('static', filename='photo2.png') }}" },
            { id: 3, content: 'Mickey17 Night', icon: "{{ url_for('static', filename='photo3.png') }}" },
            { id: 4, content: 'May Maggie Morning', icon: "{{ url_for('static', filename='photo4.png') }}" },
            { id: 5, content: 'Wipro Kakinada Week', icon: "{{ url_for('static', filename='photo5.png') }}" },
            { id: 6, content: 'Memory Six', icon: "{{ url_for('static', filename='photo6.png') }}" },
            { id: 7, content: 'Memory Seven', icon: "{{ url_for('static', filename='photo7.png') }}" },
            { id: 8, content: 'Memory Eight', icon: "{{ url_for('static', filename='photo8.png') }}" },
        ];

        // Coupon Questions Data (UPDATED REWARDS)
        const COUPON_QUESTIONS = [
            { 
                id: 1, 
                question: "Who is the cutest person in the world?", 
                options: ["Sampreethi", "Raghu", "Both"], 
                correct: "Sampreethi",
                rewardTitle: "The Human Taxi Service",
                rewardDesc: "One free piggyback ride whenever you feel like it. No distance limit(be kind pls)."
            },
            { 
                id: 2, 
                question: "What is raghu's favorite thing to do?", 
                options: ["Eating", "Sleeping", "Annoying Sam"], 
                correct: "Annoying Sam",
                rewardTitle: "The 'SEX' Card",
                rewardDesc: "One time validity. Your wish is my command cutu. üòâ"
            },
            { 
                id: 3, 
                question: "If Sampreethi angry, what should raghu do?", 
                options: ["Make fun of her", "Feed her food", "Ignore her"], 
                correct: "Feed her food",
                rewardTitle: "The Flower Finder",
                rewardDesc: "I will find and bring you flowers. Anytime. Anywhere."
            },
            { 
                id: 4, 
                question: "Where do Raghu belong?", 
                options: ["In Sampreethi's arms", "In hell", "In class"], 
                correct: "In Sampreethi's arms",
                rewardTitle: "The Smooth Touch",
                rewardDesc: "One uninterrupted full body massage to melt your stress away."
            },
            { 
                id: 5, 
                question: "Do you love me?", 
                options: ["Yes", "Maybe", "No"], 
                correct: "Yes",
                rewardTitle: "what you see, I see",
                rewardDesc: "We watch exactly what YOU want. Even if it's terrible, I won't complain."
            }
        ];

        const FINAL_GIFT = {
            title: "Merry Christmas, my cutu!", 
            message: "I'm now coming to your wonderful college event. And you can kiss me now.\nI love youuuuu üí©",
            photoUrl: "{{ url_for('static', filename='final_photo.jpg') }}", 
        };

        // --- STATE & UTILS ---
        const appRoot = document.getElementById('app-root');
        let currentView = 'start';
        let couponState = COUPON_QUESTIONS.map(q => ({ status: 'unanswered' })); 
        let oweData = JSON.parse(localStorage.getItem('oweData')) || {
            raghu: { count: 0, logs: [], showLogs: false },
            sampreethi: { count: 0, logs: [], showLogs: false }
        };

        const shuffleArray = (array) => {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        };

        const saveOweData = () => { localStorage.setItem('oweData', JSON.stringify(oweData)); };

        // --- RENDER FUNCTIONS ---

        function renderStartScreen() {
            appRoot.innerHTML = `
                <div class="text-center p-8 bg-white rounded-xl shadow-2xl border-t-8 border-red-600 relative overflow-hidden">
                    <div class="absolute top-0 right-0 p-2 text-4xl opacity-20">‚ùÑÔ∏è</div>
                    <div class="absolute top-0 left-0 p-2 text-4xl opacity-20">üéÑ</div>
                    
                    <div class="text-7xl mb-2 animate-bounce">üéÖ</div>
                    <h1 class="text-4xl font-extrabold text-red-700 mb-2 tracking-tight">Christmas Love Quest</h1>
                    <p class="text-lg text-green-700 font-medium mb-8">Ho Ho Ho! Choose your present, my love.</p>
                    
                    <div class="space-y-4">
                        <button id="start-btn" class="btn-festive w-full py-4 px-6 bg-red-600 text-white font-bold text-lg rounded-xl shadow-lg border-b-4 border-red-800 hover:bg-red-700 flex items-center justify-center gap-3">
                            üéÆ Play The Memory Game
                        </button>

                        <button id="coupons-btn" class="btn-festive w-full py-4 px-6 bg-green-600 text-white font-bold text-lg rounded-xl shadow-lg border-b-4 border-green-800 hover:bg-green-700 flex items-center justify-center gap-3">
                            üéÅ Unwrap Your Coupons
                        </button>

                        <button id="owe-btn" class="btn-festive w-full py-4 px-6 bg-yellow-500 text-red-900 font-bold text-lg rounded-xl shadow-lg border-b-4 border-yellow-600 hover:bg-yellow-400 flex items-center justify-center gap-3">
                            üìù The "You Owe Me" List
                        </button>
                    </div>
                    
                    <p class="mt-8 text-xs text-gray-400">Made with ‚ù§Ô∏è and ‚ùÑÔ∏è for Sampreethi</p>
                </div>
            `;
            document.getElementById('start-btn').onclick = () => { renderQuiz(); };
            document.getElementById('coupons-btn').onclick = () => { renderCoupons(); };
            document.getElementById('owe-btn').onclick = () => { renderOweTracker(); };
        }

        // --- QUIZ & GAME LOGIC (Styles updated to Red/Green) ---
        let currentQuestionIndex = 0;
        let answers = {};
        
        function renderQuiz() {
            const currentQuestion = QUIZ_QUESTIONS[currentQuestionIndex];
            if (!currentQuestion) { renderQuizResult(); return; }
            
            let navHtml = `<p onclick="renderStartScreen()" class="back-btn text-red-600 font-bold mb-4">‚Üê Home</p>`;
            
            appRoot.innerHTML = `
                <div class="p-6 bg-white rounded-xl shadow-2xl border-t-4 border-green-600">
                    ${navHtml}
                    <div class="text-sm text-green-600 mb-2 font-bold uppercase tracking-wide">Question ${currentQuestionIndex + 1}/${QUIZ_QUESTIONS.length}</div>
                    <h2 class="text-2xl font-bold text-gray-800 mb-6">${currentQuestion.question}</h2>
                    <div id="options-container" class="space-y-3"></div>
                </div>
            `;
            const container = document.getElementById('options-container');
            currentQuestion.options.forEach(option => {
                const btn = document.createElement('button');
                btn.textContent = option;
                btn.className = "w-full text-left py-3 px-4 bg-red-50 text-gray-800 rounded-lg hover:bg-red-100 border border-red-100 font-medium transition";
                btn.onclick = () => { answers[currentQuestion.id] = option; currentQuestionIndex++; renderQuiz(); };
                container.appendChild(btn);
            });
        }

        function renderQuizResult() {
            const score = QUIZ_QUESTIONS.filter(q => answers[q.id] === q.correctAnswer).length;
            const passed = score === QUIZ_QUESTIONS.length;
            appRoot.innerHTML = `
                <div class="text-center p-8 bg-white rounded-xl shadow-2xl border-t-4 ${passed ? 'border-green-500' : 'border-red-500'}">
                    <div class="text-6xl mb-4">${passed ? 'üåü' : 'üç™'}</div>
                    <h2 class="text-3xl font-bold mb-4 text-gray-800">Quiz Complete!</h2>
                    <p class="text-5xl font-extrabold mb-6 ${passed ? 'text-green-600' : 'text-red-600'}">${score}/${QUIZ_QUESTIONS.length}</p>
                    ${passed ? `<button onclick="initializeGame(); renderMatchingGame()" class="w-full py-3 bg-red-600 text-white font-bold rounded-xl shadow-lg hover:bg-red-700">Unlock Memories (Level 2)</button>` 
                             : `<button onclick="currentQuestionIndex=0; renderQuiz()" class="w-full py-3 bg-gray-400 text-white font-bold rounded-xl">Try Again</button>`}
                </div>`;
        }

        // --- MATCHING GAME (Styles updated) ---
        let gameTiles = [], flippedTiles = [], matchedPairs = 0, lockBoard = false;
        function initializeGame() {
            const doubled = MEMORY_PAIRS.flatMap(p => [{...p, uuid: p.id+'a'}, {...p, uuid: p.id+'b'}]);
            gameTiles = shuffleArray(doubled).map(t => ({...t, isFlipped: false, isMatched: false}));
            flippedTiles = []; matchedPairs = 0; lockBoard = false;
        }

        function renderMatchingGame() {
            appRoot.innerHTML = `
                <div class="text-center p-4 bg-white rounded-xl shadow-2xl border-t-4 border-red-600">
                    <p class="text-sm font-bold text-gray-500 mb-2">Matches: ${matchedPairs}/${MEMORY_PAIRS.length}</p>
                    <div class="grid grid-cols-4 gap-2" id="game-board"></div>
                </div>`;
            const board = document.getElementById('game-board');
            gameTiles.forEach((tile, idx) => {
                const el = document.createElement('div');
                el.className = `flip-container aspect-square ${tile.isFlipped ? 'flipped' : ''} ${tile.isMatched ? 'invisible' : ''}`;
                el.innerHTML = `<div class="flipper w-full h-full"><div class="front bg-red-100 rounded-lg flex items-center justify-center text-3xl border-2 border-red-200">üéÅ</div><div class="back bg-white border-2 border-red-500 rounded-lg overflow-hidden"><img src="${tile.icon}" class="w-full h-full object-cover"></div></div>`;
                el.onclick = () => handleTileClick(idx);
                board.appendChild(el);
            });
        }

        function handleTileClick(index) {
            if (lockBoard || gameTiles[index].isFlipped || gameTiles[index].isMatched) return;
            gameTiles[index].isFlipped = true;
            flippedTiles.push(index);
            renderMatchingGame();
            
            if (flippedTiles.length === 2) {
                lockBoard = true;
                const [i1, i2] = flippedTiles;
                if (gameTiles[i1].id === gameTiles[i2].id) {
                    setTimeout(() => {
                        gameTiles[i1].isMatched = true; gameTiles[i2].isMatched = true;
                        matchedPairs++; flippedTiles = []; lockBoard = false; renderMatchingGame();
                        if (matchedPairs === MEMORY_PAIRS.length) renderFinalScreen();
                    }, 600);
                } else {
                    setTimeout(() => {
                        gameTiles[i1].isFlipped = false; gameTiles[i2].isFlipped = false;
                        flippedTiles = []; lockBoard = false; renderMatchingGame();
                    }, 800);
                }
            }
        }

        function renderFinalScreen() {
            appRoot.innerHTML = `
                <div class="text-center p-8 bg-white rounded-xl shadow-2xl border-t-4 border-yellow-400">
                    <h1 class="text-3xl font-bold mb-4 text-red-600">${FINAL_GIFT.title}</h1>
                    <img src="${FINAL_GIFT.photoUrl}" class="w-full rounded-lg mb-4 border-4 border-green-100">
                    <p class="mb-6 whitespace-pre-wrap text-gray-700">${FINAL_GIFT.message}</p>
                    <button onclick="renderStartScreen()" class="px-6 py-2 bg-gray-100 rounded-full font-bold text-gray-600 hover:bg-gray-200">Back to Home</button>
                </div>`;
        }

        // --- FEATURE: COUPONS (Updated Text & Styles) ---

        function renderCoupons() {
            appRoot.innerHTML = `
                <div class="p-4 bg-white rounded-xl shadow-2xl border-t-4 border-green-600 min-h-screen">
                    <div class="flex items-center mb-6">
                        <button onclick="renderStartScreen()" class="text-red-600 font-bold mr-4">‚Üê Back</button>
                        <h2 class="text-2xl font-bold text-gray-800">üéÑ Christmas Coupons</h2>
                    </div>
                    <div id="coupons-list" class="space-y-6">
                        </div>
                </div>
            `;
            const list = document.getElementById('coupons-list');
            
            COUPON_QUESTIONS.forEach((q, idx) => {
                const state = couponState[idx];
                const wrapper = document.createElement('div');
                
                if (state.status === 'unanswered') {
                    // Render Question
                    wrapper.innerHTML = `
                        <div class="bg-red-50 p-5 rounded-lg border border-red-100">
                            <h3 class="font-bold text-red-800 mb-3">üéÅ Gift #${idx+1}: Answer to Unlock</h3>
                            <p class="text-sm text-gray-600 mb-3 italic">${q.question}</p>
                            <div class="space-y-2 mb-3">
                                ${q.options.map(opt => `
                                    <label class="flex items-center space-x-2 p-3 bg-white rounded cursor-pointer hover:bg-red-100 border border-gray-100 transition">
                                        <input type="radio" name="q${idx}" value="${opt}" class="text-red-600 focus:ring-red-500">
                                        <span class="text-sm text-gray-800 font-medium">${opt}</span>
                                    </label>
                                `).join('')}
                            </div>
                            <button onclick="checkCouponAnswer(${idx})" class="w-full py-2 bg-green-600 hover:bg-green-700 text-white rounded font-bold text-sm shadow transition">Unlock Gift</button>
                        </div>
                    `;
                } else {
                    // Render Coupon (Won or Redeemed)
                    const isRedeemed = state.status === 'redeemed';
                    wrapper.innerHTML = `
                        <div class="coupon-card p-6 rounded-lg text-center ${isRedeemed ? 'is-redeemed' : ''}">
                            <div class="stamp">Redeemed üéÖ</div>
                            <div class="text-4xl mb-2">ü¶å</div>
                            <h3 class="text-xl font-black text-red-600 mb-1 uppercase tracking-tight">${q.rewardTitle}</h3>
                            <p class="text-sm text-gray-600 mb-4 font-medium px-4">${q.rewardDesc}</p>
                            <button onclick="redeemCoupon(${idx})" ${isRedeemed ? 'disabled' : ''} 
                                class="px-6 py-2 ${isRedeemed ? 'bg-gray-300 text-gray-500' : 'bg-red-600 hover:bg-red-700 text-white'} font-bold rounded-full shadow-lg transition transform hover:scale-105">
                                ${isRedeemed ? 'Used' : 'Redeem Now'}
                            </button>
                        </div>
                    `;
                }
                list.appendChild(wrapper);
            });
        }

        function checkCouponAnswer(idx) {
            const selected = document.querySelector(`input[name="q${idx}"]:checked`);
            if (!selected) return alert("Santa says: Pick an answer first!");
            
            if (selected.value === COUPON_QUESTIONS[idx].correct) {
                couponState[idx].status = 'won';
                renderCoupons();
            } else {
                alert("Oh no! That's not correct. Try again!");
            }
        }

        function redeemCoupon(idx) {
            if(!confirm("Are you sure you want to redeem this Christmas gift?")) return;
            couponState[idx].status = 'redeemed';
            renderCoupons();
        }

        // --- FEATURE: OWE TRACKER (Festive Style) ---

        function updateOwe(person, change) {
            oweData[person].count += change;
            const logMsg = change > 0 ? `Added 1 owe` : `Removed 1 owe`;
            const dateStr = new Date().toLocaleString('en-IN', { month: 'short', day: 'numeric', hour: '2-digit', minute:'2-digit'});
            oweData[person].logs.unshift({ date: dateStr, msg: logMsg });
            if (oweData[person].logs.length > 20) oweData[person].logs.pop();
            saveOweData();
            renderOweTracker();
        }

        function toggleLogs(person) {
            oweData[person].showLogs = !oweData[person].showLogs;
            saveOweData();
            renderOweTracker();
        }

        function renderOweTracker() {
            appRoot.innerHTML = `
                <div class="p-6 bg-white rounded-xl shadow-2xl border-t-4 border-yellow-500 min-h-screen">
                    <div class="flex items-center mb-6">
                        <button onclick="renderStartScreen()" class="text-yellow-600 font-bold mr-4">‚Üê Back</button>
                        <h2 class="text-2xl font-bold text-gray-800">üìú The Naughty & Nice List</h2>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        ${renderPersonCard('raghu', 'Raghu')}
                        ${renderPersonCard('sampreethi', 'Sampreethi')}
                    </div>
                </div>
            `;
        }

        function renderPersonCard(key, name) {
            const data = oweData[key];
            const logHtml = data.logs.slice(0, 10).map(l => `
                <li class="text-xs text-gray-500 flex justify-between border-b border-gray-100 py-1">
                    <span>${l.msg}</span> <span class="text-gray-400">${l.date}</span>
                </li>
            `).join('');

            return `
                <div class="bg-red-50 rounded-xl p-4 border border-red-100 relative">
                    <div class="absolute -top-3 -right-3 text-2xl">üéÖ</div>
                    <h3 class="text-xl font-bold text-red-800 text-center mb-2">${name}</h3>
                    <div class="text-center mb-4">
                        <span class="text-5xl font-black ${data.count >= 0 ? 'text-green-600' : 'text-red-500'}">
                            ${data.count}
                        </span>
                        <p class="text-xs text-gray-400 uppercase tracking-widest mt-1">Total Owes</p>
                    </div>
                    
                    <div class="flex justify-center gap-4 mb-4">
                        <button onclick="updateOwe('${key}', -1)" class="w-12 h-12 rounded-full bg-white border border-red-200 text-red-600 font-bold text-xl hover:bg-red-50 shadow-sm">-</button>
                        <button onclick="updateOwe('${key}', 1)" class="w-12 h-12 rounded-full bg-white border border-green-200 text-green-600 font-bold text-xl hover:bg-green-50 shadow-sm">+</button>
                    </div>

                    <div class="text-center">
                        <button onclick="toggleLogs('${key}')" class="text-xs text-yellow-600 font-bold underline mb-2">
                            ${data.showLogs ? 'Hide History' : 'Show History'}
                        </button>
                        ${data.showLogs ? `<ul class="text-left bg-white p-2 rounded shadow-inner max-h-40 overflow-y-auto">${logHtml || '<li class="text-xs text-center text-gray-400">No logs yet</li>'}</ul>` : ''}
                    </div>
                </div>
            `;
        }

        // Start App
        renderStartScreen();
    </script>
</body>
</html>